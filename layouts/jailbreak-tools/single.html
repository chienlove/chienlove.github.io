{{ define "head" }}
    <link rel="stylesheet" href="/css/jailbreak-tools.css?v={{ now.Unix }}">
{{ end }}

{{ define "main" }}
<main role="main" class="container">
    <!-- Main Tool Card -->
    <section class="card">
        <div class="card-header">
            <div class="tool-header">
                <img src="{{ .Params.icon }}" alt="{{ .Title }} Icon" class="tool-icon">
                <div class="tool-meta">
                    <h1 class="tool-title">{{ .Title }}</h1>
                    <div class="tool-version-dev">
                        <span class="tool-version-label">Version: {{ .Params.main_download.version }}</span>
                        <span class="tool-developer-label">Developer: {{ with .Params.developer }}{{ . }}{{ else }}Unknown{{ end }}</span>
                    </div>
                </div>
                {{ if .Params.main_download }}
                <a href="/download?appId={{ .Params.main_download.appId }}" class="get-button" target="_blank">Download</a>
                {{ end }}
            </div>
        </div>
        
        <div class="card-body">
            <!-- Description Section -->
            <div class="mb-4">
                <h3 class="section-title">Description</h3>
                <div class="description-container">
                    {{ $description := .Params.description | markdownify }}
                    {{ $words := split $description " " }}
                    {{ if gt (len $words) 50 }}
                        <div id="short-description">
                            {{ delimit (first 50 $words) " " | safeHTML }}
                            <button id="toggle-description" class="description-toggle">Read more</button>
                        </div>
                        <div id="full-description" class="hidden">
                            {{ $description | safeHTML }}
                            <button id="toggle-description" class="description-toggle expanded">Show less</button>
                        </div>
                    {{ else }}
                        <div id="full-description">
                            {{ $description | safeHTML }}
                        </div>
                    {{ end }}
                </div>
            </div>
            
            <!-- Screenshots Section -->
            {{ if .Params.screenshots }}
            <div class="mb-4">
                <h3 class="section-title">Screenshots</h3>
                <div class="screenshots">
                    {{ range .Params.screenshots }}
                        <div class="screenshot">
                            <img src="{{ . }}" alt="Screenshot">
                        </div>
                    {{ end }}
                </div>
            </div>
            {{ end }}
            
            <!-- Details Section -->
            <div>
                <h3 class="section-title">Details</h3>
                <div class="tool-details-grid">
                    <div class="tool-detail">
                        <span class="tool-detail-label">Developer</span>
                        <span class="tool-detail-value">{{ with .Params.developer }}{{ . }}{{ else }}Unknown{{ end }}</span>
                    </div>
                    <div class="tool-detail">
                        <span class="tool-detail-label">Category</span>
                        <span class="tool-detail-value">{{ with .Params.categories }}{{ . }}{{ else }}Unknown{{ end }}</span>
                    </div>
                    <div class="tool-detail">
                        <span class="tool-detail-label">Size</span>
                        <span class="tool-detail-value">{{ with .Params.size }}{{ . }}{{ else }}Unknown{{ end }}</span>
                    </div>
                    <div class="tool-detail">
                        <span class="tool-detail-label">iOS Version</span>
                        <span class="tool-detail-value">{{ with .Params.ios_compatible }}{{ . }}{{ else }}Unknown{{ end }}</span>
                    </div>
                    <div class="tool-detail">
                        <span class="tool-detail-label">Keywords</span>
                        <span class="tool-detail-value">{{ if .Params.keywords }}{{ delimit .Params.keywords ", " }}{{ else }}None{{ end }}</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Other Versions Card -->
    {{ if .Params.other_versions }}
    <section class="card">
        <div class="card-header">
            <h3 class="section-title">Other Versions</h3>
        </div>
        <div class="card-body">
            <div class="download-links-grid">
                {{ $versions := .Params.other_versions }}
                {{ if gt (len $versions) 0 }}
                    {{ range $versions }}
                        <a href="/download?appId={{ .appId }}" class="download-link" target="_blank">
                            {{ printf "%s %s" $.Title .version }}
                        </a>
                    {{ end }}
                {{ else }}
                    <p>No other versions available.</p>
                {{ end }}
            </div>
        </div>
    </section>
    {{ end }}
</main>

<script>
    function toggleDescription() {
        const shortDesc = document.getElementById('short-description');
        const fullDesc = document.getElementById('full-description');
        const toggleButtons = document.querySelectorAll('#toggle-description');
        
        if (shortDesc.style.display === 'none') {
            shortDesc.style.display = 'block';
            fullDesc.style.display = 'none';
            toggleButtons.forEach(btn => {
                btn.textContent = 'Read more';
                btn.classList.remove('expanded');
            });
        } else {
            shortDesc.style.display = 'none';
            fullDesc.style.display = 'block';
            toggleButtons.forEach(btn => {
                btn.textContent = 'Show less';
                btn.classList.add('expanded');
            });
        }
    }
    
    // Initialize toggle buttons
    document.querySelectorAll('#toggle-description').forEach(btn => {
        btn.addEventListener('click', toggleDescription);
    });
</script>
{{ end }}