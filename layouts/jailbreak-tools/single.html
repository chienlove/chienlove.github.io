{{ define "head" }}
    <link rel="stylesheet" href="/css/jailbreak-tools.css?v={{ now.Unix }}">
{{ end }}

{{ define "main" }}
<div class="tool-container">
    <!-- Tool Header Section -->
    <div class="tool-header">
        <img src="{{ .Params.icon }}" alt="{{ .Title }} Icon" class="tool-icon">
        <div class="tool-name-and-details">
            <h1 class="tool-title">{{ .Title }}</h1>
            <div class="tool-version-dev">
                <span class="tool-version-label">Version: {{ .Params.main_download.version }}</span>
                <span class="tool-developer-label">Developer: {{ with .Params.developer }}{{ . }}{{ else }}Unknown{{ end }}</span>
            </div>
        </div>
        {{ if .Params.main_download }}
        <a href="/download?appId={{ .Params.main_download.appId }}" class="get-button">GET</a>
        {{ end }}
    </div>

    <!-- Description Section -->
    <div id="description-container">
        <h3>Description</h3>
        {{ $description := .Params.description | markdownify }}
        {{ $words := split $description " " }}
        {{ if gt (len $words) 30 }}
            <p>
                {{ delimit (first 30 $words) " " | safeHTML }}
                <button id="toggle-description" class="read-more-button">Read more</button>
            </p>
            <div id="full-description" class="hidden">
                {{ $description | safeHTML }}
                <button id="toggle-description" class="read-more-button">Show less</button>
            </div>
        {{ else }}
            <p>{{ $description | safeHTML }}</p>
        {{ end }}
    </div>

    <!-- Details Section -->
    <div class="tool-details-container">
        <h3>Details</h3>
        <div class="tool-details">
            <strong>Developer:</strong>
            <span>{{ with .Params.developer }}{{ . }}{{ else }}Unknown{{ end }}</span>
        </div>
        <div class="tool-details">
            <strong>Category:</strong>
            <span>{{ with .Params.categories }}{{ . }}{{ else }}Unknown{{ end }}</span>
        </div>
        <div class="tool-details">
            <strong>Size:</strong>
            <span>{{ with .Params.size }}{{ . }}{{ else }}Unknown{{ end }}</span>
        </div>
        <div class="tool-details">
            <strong>Compatible iOS:</strong>
            <span>{{ with .Params.ios_compatible }}{{ . }}{{ else }}Unknown{{ end }}</span>
        </div>
        <div class="tool-details">
            <strong>Keywords:</strong>
            <span>{{ if .Params.keywords }}{{ delimit .Params.keywords ", " }}{{ else }}None{{ end }}</span>
        </div>
    </div>

    <!-- Other Versions Section -->
    {{ if .Params.other_versions }}
    <div class="tool-details-container">
        <h3>Other Versions</h3>
        {{ $versions := .Params.other_versions }}
        {{ if gt (len $versions) 0 }}
            {{ range $versions }}
                <div class="tool-details">
                    <strong>{{ .version }}:</strong>
                    <span><a href="/download?appId={{ .appId }}" class="get-button small">Download</a></span>
                </div>
            {{ end }}
        {{ else }}
            <p>No other versions available.</p>
        {{ end }}
    </div>
    {{ end }}
</div>

<script>
    function toggleDescription() {
        const shortDesc = document.querySelector('#description-container p');
        const fullDesc = document.getElementById('full-description');
        const toggleButtons = document.querySelectorAll('#toggle-description');
        
        if (fullDesc.classList.contains('hidden')) {
            shortDesc.style.display = 'none';
            fullDesc.classList.remove('hidden');
            toggleButtons.forEach(btn => btn.textContent = 'Show less');
        } else {
            shortDesc.style.display = 'block';
            fullDesc.classList.add('hidden');
            toggleButtons.forEach(btn => btn.textContent = 'Read more');
        }
    }
    
    // Initialize toggle buttons
    document.querySelectorAll('#toggle-description').forEach(btn => {
        btn.addEventListener('click', toggleDescription);
    });
</script>
{{ end }}