{{ define "main" }}
<div id="shortener">
  <h1>{{ .Title }}</h1>
  <form id="shorten-form">
    <input type="url" id="url-input" placeholder="Nhập URL cần rút gọn" required>
    <button type="submit">Rút gọn</button>
  </form>
  <div id="result"></div>
</div>

<script>
document.getElementById('shorten-form').addEventListener('submit', async (e) => {
  e.preventDefault()
  const url = document.getElementById('url-input').value
  const response = await fetch('/.netlify/functions/shorten', {
    method: 'POST',
    body: JSON.stringify({ url })
  })
  const data = await response.json()
  if (data.shortId) {
    const shortUrl = `${window.location.origin}/.netlify/functions/redirect?shortId=${data.shortId}`
    document.getElementById('result').innerHTML = `
      <p>Link rút gọn của bạn: <a href="${shortUrl}" target="_blank">${shortUrl}</a></p>
    `
  } else {
    document.getElementById('result').innerHTML = '<p>Có lỗi xảy ra. Vui lòng thử lại.</p>'
  }
})
</script>
{{ end }}