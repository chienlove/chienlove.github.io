{"version":3,"sources":["@wordpress/components/src/search-control/index.native.js"],"names":["TextInput","Text","View","TouchableOpacity","Platform","useColorScheme","Keyboard","useState","useRef","useMemo","useEffect","__","Button","Gridicons","Icon","cancelCircleFilled","cancelCircleFilledIcon","arrowLeft","arrowLeftIcon","close","closeIcon","allStyles","platformStyles","baseStyles","selector","selectModifiedStyles","styles","modifier","modifierMatcher","RegExp","modifierSelectors","Object","keys","filter","match","reduce","modifiedStyles","modifierSelector","blockElementSelector","split","mergeStyles","updateStyles","selectors","forEach","SearchControl","value","onChange","placeholder","isActive","setIsActive","currentStyles","setCurrentStyles","isDark","inputRef","onCancelTimer","isIOS","OS","darkStyles","activeStyles","activeDarkStyles","futureStyles","mergeFutureStyles","shouldUseConditions","shouldUseModified","every","should","updatedStyles","keyboardHideSubscription","addListener","onCancel","clearTimeout","current","remove","containerStyle","innerContainerStyle","inputContainerStyle","formInputStyle","placeholderStyle","inputButtonStyle","inputButtonLeftStyle","inputButtonRightStyle","cancelButtonStyle","cancelButtonTextStyle","iconStyle","rightIconStyle","clearInput","setTimeout","blur","renderLeftButton","button","search","color","renderRightButton","renderCancel","focus"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tTextInput,\n\tText,\n\tView,\n\tTouchableOpacity,\n\tPlatform,\n\tuseColorScheme,\n\tKeyboard,\n} from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { useState, useRef, useMemo, useEffect } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { Button, Gridicons } from '@wordpress/components';\nimport {\n\tIcon,\n\tcancelCircleFilled as cancelCircleFilledIcon,\n\tarrowLeft as arrowLeftIcon,\n\tclose as closeIcon,\n} from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport allStyles from './style.scss';\nimport platformStyles from './platform-style.scss';\n\n// Merge platform specific styles with the default styles.\nconst baseStyles = { ...allStyles };\nfor ( const selector in platformStyles ) {\n\tbaseStyles[ selector ] = {\n\t\t...baseStyles[ selector ],\n\t\t...platformStyles[ selector ],\n\t};\n}\n\nfunction selectModifiedStyles( styles, modifier ) {\n\tconst modifierMatcher = new RegExp( `--${ modifier }$` );\n\tconst modifierSelectors = Object.keys( styles ).filter( ( selector ) =>\n\t\tselector.match( modifierMatcher )\n\t);\n\n\treturn modifierSelectors.reduce( ( modifiedStyles, modifierSelector ) => {\n\t\tconst blockElementSelector = modifierSelector.split( '--' )[ 0 ];\n\t\tmodifiedStyles[ blockElementSelector ] = styles[ modifierSelector ];\n\t\treturn modifiedStyles;\n\t}, {} );\n}\n\nfunction mergeStyles( styles, updateStyles, selectors ) {\n\tselectors.forEach( ( selector ) => {\n\t\tstyles[ selector ] = {\n\t\t\t...styles[ selector ],\n\t\t\t...updateStyles[ selector ],\n\t\t};\n\t} );\n\n\treturn styles;\n}\n\nfunction SearchControl( {\n\tvalue,\n\tonChange,\n\tplaceholder = __( 'Search blocks' ),\n} ) {\n\tconst [ isActive, setIsActive ] = useState( false );\n\tconst [ currentStyles, setCurrentStyles ] = useState( baseStyles );\n\n\tconst isDark = useColorScheme() === 'dark';\n\tconst inputRef = useRef();\n\tconst onCancelTimer = useRef();\n\n\tconst isIOS = Platform.OS === 'ios';\n\n\tconst darkStyles = useMemo( () => {\n\t\treturn selectModifiedStyles( baseStyles, 'dark' );\n\t}, [] );\n\n\tconst activeStyles = useMemo( () => {\n\t\treturn selectModifiedStyles( baseStyles, 'active' );\n\t}, [] );\n\n\tconst activeDarkStyles = useMemo( () => {\n\t\treturn selectModifiedStyles( baseStyles, 'active-dark' );\n\t}, [] );\n\n\tuseEffect( () => {\n\t\tlet futureStyles = { ...baseStyles };\n\n\t\tfunction mergeFutureStyles( modifiedStyles, shouldUseConditions ) {\n\t\t\tconst shouldUseModified = shouldUseConditions.every(\n\t\t\t\t( should ) => should\n\t\t\t);\n\n\t\t\tconst updatedStyles = shouldUseModified\n\t\t\t\t? modifiedStyles\n\t\t\t\t: futureStyles;\n\n\t\t\tconst selectors = Object.keys( modifiedStyles );\n\n\t\t\tfutureStyles = mergeStyles(\n\t\t\t\tfutureStyles,\n\t\t\t\tupdatedStyles,\n\t\t\t\tselectors\n\t\t\t);\n\t\t}\n\n\t\tmergeFutureStyles( activeStyles, [ isActive ] );\n\t\tmergeFutureStyles( darkStyles, [ isDark ] );\n\t\tmergeFutureStyles( activeDarkStyles, [ isActive, isDark ] );\n\n\t\tsetCurrentStyles( futureStyles );\n\t\t// Disable reason: deferring this refactor to the native team.\n\t\t// see https://github.com/WordPress/gutenberg/pull/41166\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ isActive, isDark ] );\n\n\tuseEffect( () => {\n\t\tconst keyboardHideSubscription = Keyboard.addListener(\n\t\t\t'keyboardDidHide',\n\t\t\t() => {\n\t\t\t\tif ( ! isIOS ) {\n\t\t\t\t\tonCancel();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\treturn () => {\n\t\t\tclearTimeout( onCancelTimer.current );\n\t\t\tkeyboardHideSubscription.remove();\n\t\t};\n\t\t// Disable reason: deferring this refactor to the native team.\n\t\t// see https://github.com/WordPress/gutenberg/pull/41166\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [] );\n\n\tconst {\n\t\t'search-control__container': containerStyle,\n\t\t'search-control__inner-container': innerContainerStyle,\n\t\t'search-control__input-container': inputContainerStyle,\n\t\t'search-control__form-input': formInputStyle,\n\t\t'search-control__form-input-placeholder': placeholderStyle,\n\t\t'search-control__input-button': inputButtonStyle,\n\t\t'search-control__input-button-left': inputButtonLeftStyle,\n\t\t'search-control__input-button-right': inputButtonRightStyle,\n\t\t'search-control__cancel-button': cancelButtonStyle,\n\t\t'search-control__cancel-button-text': cancelButtonTextStyle,\n\t\t'search-control__icon': iconStyle,\n\t\t'search-control__right-icon': rightIconStyle,\n\t} = currentStyles;\n\n\tfunction clearInput() {\n\t\tonChange( '' );\n\t}\n\n\tfunction onCancel() {\n\t\tonCancelTimer.current = setTimeout( () => {\n\t\t\tinputRef.current.blur();\n\t\t\tclearInput();\n\t\t\tsetIsActive( false );\n\t\t}, 0 );\n\t}\n\n\tfunction renderLeftButton() {\n\t\tconst button =\n\t\t\t! isIOS && isActive ? (\n\t\t\t\t<Button\n\t\t\t\t\tlabel={ __( 'Cancel search' ) }\n\t\t\t\t\ticon={ arrowLeftIcon }\n\t\t\t\t\tonClick={ onCancel }\n\t\t\t\t\tstyle={ iconStyle }\n\t\t\t\t/>\n\t\t\t) : (\n\t\t\t\t<Icon icon={ Gridicons.search } fill={ iconStyle?.color } />\n\t\t\t);\n\n\t\treturn (\n\t\t\t<View style={ [ inputButtonStyle, inputButtonLeftStyle ] }>\n\t\t\t\t{ button }\n\t\t\t</View>\n\t\t);\n\t}\n\n\tfunction renderRightButton() {\n\t\tlet button;\n\n\t\t// Add a View element to properly center the input placeholder via flexbox.\n\t\tif ( isIOS && ! isActive ) {\n\t\t\tbutton = <View />;\n\t\t}\n\n\t\tif ( !! value ) {\n\t\t\tbutton = (\n\t\t\t\t<Button\n\t\t\t\t\tlabel={ __( 'Clear search' ) }\n\t\t\t\t\ticon={ isIOS ? cancelCircleFilledIcon : closeIcon }\n\t\t\t\t\tonClick={ clearInput }\n\t\t\t\t\tstyle={ [ iconStyle, rightIconStyle ] }\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\t<View style={ [ inputButtonStyle, inputButtonRightStyle ] }>\n\t\t\t\t{ button }\n\t\t\t</View>\n\t\t);\n\t}\n\n\tfunction renderCancel() {\n\t\tif ( ! isIOS ) {\n\t\t\treturn null;\n\t\t}\n\t\treturn (\n\t\t\t<View style={ cancelButtonStyle }>\n\t\t\t\t<Text\n\t\t\t\t\tonPress={ onCancel }\n\t\t\t\t\tstyle={ cancelButtonTextStyle }\n\t\t\t\t\taccessible={ true }\n\t\t\t\t\taccessibilityRole={ 'button' }\n\t\t\t\t\taccessibilityLabel={ __( 'Cancel search' ) }\n\t\t\t\t\taccessibilityHint={ __( 'Cancel search' ) }\n\t\t\t\t>\n\t\t\t\t\t{ __( 'Cancel' ) }\n\t\t\t\t</Text>\n\t\t\t</View>\n\t\t);\n\t}\n\n\treturn (\n\t\t<TouchableOpacity\n\t\t\tstyle={ containerStyle }\n\t\t\tonPress={ () => {\n\t\t\t\tsetIsActive( true );\n\t\t\t\tinputRef.current.focus();\n\t\t\t} }\n\t\t\tactiveOpacity={ 1 }\n\t\t>\n\t\t\t<View style={ innerContainerStyle }>\n\t\t\t\t<View style={ inputContainerStyle }>\n\t\t\t\t\t{ renderLeftButton() }\n\t\t\t\t\t<TextInput\n\t\t\t\t\t\tref={ inputRef }\n\t\t\t\t\t\tstyle={ formInputStyle }\n\t\t\t\t\t\tplaceholderTextColor={ placeholderStyle?.color }\n\t\t\t\t\t\tonChangeText={ onChange }\n\t\t\t\t\t\tonFocus={ () => setIsActive( true ) }\n\t\t\t\t\t\tvalue={ value }\n\t\t\t\t\t\tplaceholder={ placeholder }\n\t\t\t\t\t/>\n\t\t\t\t\t{ renderRightButton() }\n\t\t\t\t</View>\n\t\t\t\t{ isActive && renderCancel() }\n\t\t\t</View>\n\t\t</TouchableOpacity>\n\t);\n}\n\nexport default SearchControl;\n"]}