{"version":3,"sources":["@wordpress/components/src/mobile/bottom-sheet/bottom-sheet-navigation/navigation-screen.native.js"],"names":["useIsFocused","useNavigation","useFocusEffect","View","ScrollView","TouchableHighlight","BottomSheetContext","debounce","useRef","useCallback","useContext","useMemo","BottomSheetNavigationContext","styles","BottomSheetNavigationScreen","children","fullScreen","isScrollable","isNested","name","navigation","heightRef","maxHeight","isFocused","onHandleHardwareButtonPress","shouldEnableBottomSheetMaxHeight","setIsFullScreen","listProps","safeAreaBottomInset","setHeight","setHeightDebounce","canGoBack","goBack","current","onLayout","nativeEvent","height","layout","scrollableContent","paddingBottom"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tuseIsFocused,\n\tuseNavigation,\n\tuseFocusEffect,\n} from '@react-navigation/native';\nimport { View, ScrollView, TouchableHighlight } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { BottomSheetContext } from '@wordpress/components';\nimport { debounce } from '@wordpress/compose';\nimport { useRef, useCallback, useContext, useMemo } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { BottomSheetNavigationContext } from './bottom-sheet-navigation-context';\nimport styles from './styles.scss';\n\nconst BottomSheetNavigationScreen = ( {\n\tchildren,\n\tfullScreen,\n\tisScrollable,\n\tisNested,\n\tname,\n} ) => {\n\tconst navigation = useNavigation();\n\tconst heightRef = useRef( { maxHeight: 0 } );\n\tconst isFocused = useIsFocused();\n\tconst {\n\t\tonHandleHardwareButtonPress,\n\t\tshouldEnableBottomSheetMaxHeight,\n\t\tsetIsFullScreen,\n\t\tlistProps,\n\t\tsafeAreaBottomInset,\n\t} = useContext( BottomSheetContext );\n\n\tconst { setHeight } = useContext( BottomSheetNavigationContext );\n\n\t// Disable reason: deferring this refactor to the native team.\n\t// see https://github.com/WordPress/gutenberg/pull/41166\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\tconst setHeightDebounce = useCallback( debounce( setHeight, 10 ), [\n\t\tsetHeight,\n\t] );\n\n\tuseFocusEffect(\n\t\tuseCallback( () => {\n\t\t\tonHandleHardwareButtonPress( () => {\n\t\t\t\tif ( navigation.canGoBack() ) {\n\t\t\t\t\tshouldEnableBottomSheetMaxHeight( true );\n\t\t\t\t\tnavigation.goBack();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tonHandleHardwareButtonPress( null );\n\t\t\t\treturn false;\n\t\t\t} );\n\t\t\t/**\n\t\t\t * TODO: onHandleHardwareButtonPress stores a single value, which means\n\t\t\t * future invocations from sibling screens can replace the callback for\n\t\t\t * the currently active screen. Currently, the empty dependency array\n\t\t\t * passed to useCallback here is what prevents erroneous callback\n\t\t\t * replacements, but leveraging memoization to achieve this is brittle and\n\t\t\t * explicitly discouraged in the React documentation.\n\t\t\t * https://reactjs.org/docs/hooks-reference.html#usememo\n\t\t\t *\n\t\t\t * Ideally, we refactor onHandleHardwareButtonPress to manage multiple\n\t\t\t * callbacks triggered based upon which screen is currently active.\n\t\t\t *\n\t\t\t * Related: https://github.com/WordPress/gutenberg/pull/36328#discussion_r768897546\n\t\t\t */\n\t\t\t// see https://github.com/WordPress/gutenberg/pull/41166\n\t\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\t}, [] )\n\t);\n\n\tuseFocusEffect(\n\t\tuseCallback( () => {\n\t\t\tif ( fullScreen ) {\n\t\t\t\tsetHeight( '100%' );\n\t\t\t\tsetIsFullScreen( true );\n\t\t\t} else if ( heightRef.current.maxHeight !== 0 ) {\n\t\t\t\tsetIsFullScreen( false );\n\t\t\t\tsetHeight( heightRef.current.maxHeight );\n\t\t\t}\n\t\t\treturn () => {};\n\t\t\t// Disable reason: deferring this refactor to the native team.\n\t\t\t// see https://github.com/WordPress/gutenberg/pull/41166\n\t\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\t}, [ setHeight ] )\n\t);\n\n\tconst onLayout = ( { nativeEvent } ) => {\n\t\tif ( fullScreen ) {\n\t\t\treturn;\n\t\t}\n\t\tconst { height } = nativeEvent.layout;\n\n\t\tif ( heightRef.current.maxHeight !== height && isFocused ) {\n\t\t\theightRef.current.maxHeight = height;\n\t\t\tsetHeightDebounce( height );\n\t\t}\n\t};\n\n\treturn useMemo( () => {\n\t\treturn isScrollable || isNested ? (\n\t\t\t<View\n\t\t\t\tonLayout={ onLayout }\n\t\t\t\ttestID={ `navigation-screen-${ name }` }\n\t\t\t>\n\t\t\t\t{ children }\n\t\t\t</View>\n\t\t) : (\n\t\t\t<ScrollView { ...listProps }>\n\t\t\t\t<TouchableHighlight accessible={ false }>\n\t\t\t\t\t<View\n\t\t\t\t\t\tonLayout={ onLayout }\n\t\t\t\t\t\ttestID={ `navigation-screen-${ name }` }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ children }\n\t\t\t\t\t\t{ ! isNested && (\n\t\t\t\t\t\t\t<View\n\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\theight:\n\t\t\t\t\t\t\t\t\t\tsafeAreaBottomInset ||\n\t\t\t\t\t\t\t\t\t\tstyles.scrollableContent.paddingBottom,\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</View>\n\t\t\t\t</TouchableHighlight>\n\t\t\t</ScrollView>\n\t\t);\n\t\t// Disable reason: deferring this refactor to the native team.\n\t\t// see https://github.com/WordPress/gutenberg/pull/41166\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [\n\t\tchildren,\n\t\tisFocused,\n\t\tsafeAreaBottomInset,\n\t\tlistProps,\n\t\tname,\n\t\tisScrollable,\n\t\tisNested,\n\t\tonLayout,\n\t] );\n};\n\nexport default BottomSheetNavigationScreen;\n"]}