{"version":3,"sources":["@wordpress/components/src/mobile/audio-player/index.native.js"],"names":["Text","TouchableWithoutFeedback","Linking","Alert","Platform","default","VideoPlayer","View","Icon","withPreferredColorScheme","__","audio","warning","requestImageFailedRetryDialog","requestImageUploadCancelDialog","getProtocol","useState","styles","parseAudioUrl","isIOS","OS","Player","getStylesFromColorScheme","isUploadInProgress","isUploadFailed","attributes","isSelected","id","src","paused","setPaused","onPressListen","player","presentFullscreenPlayer","canOpenURL","then","supported","alert","openURL","catch","containerStyle","container","containerDark","iconStyle","icon","iconDark","iconDisabledStyle","iconDisabled","iconDisabledDark","isDisabled","finalIconStyle","iconContainerStyle","iconContainer","iconContainerDark","titleContainerStyle","titleContainer","titleContainerIOS","titleContainerAndroid","titleStyle","title","titleDark","uploadFailedStyle","uploadFailed","uploadFailedDark","subtitleStyle","subtitle","subtitleDark","finalSubtitleStyle","buttonBackgroundStyle","buttonBackground","buttonBackgroundDark","extension","result","getSubtitleValue","onAudioUploadCancelDialog","subtitleContainer","errorIcon","buttonText","uri","ref"],"mappings":";;AAAA;AACA;AACA;AACA,SACCA,IADD,EAECC,wBAFD,EAGCC,OAHD,EAICC,KAJD,EAKCC,QALD,QAMO,cANP;AAOA,SAASC,OAAO,IAAIC,WAApB,QAAuC,oBAAvC;AAEA;AACA;AACA;;AACA,SAASC,IAAT,QAAqB,uBAArB;AACA,SAASC,IAAT,QAAqB,uBAArB;AACA,SAASC,wBAAT,QAAyC,oBAAzC;AACA,SAASC,EAAT,QAAmB,iBAAnB;AACA,SAASC,KAAT,EAAgBC,OAAhB,QAA+B,kBAA/B;AACA,SACCC,6BADD,EAECC,8BAFD,QAGO,gCAHP;AAIA,SAASC,WAAT,QAA4B,gBAA5B;AACA,SAASC,QAAT,QAAyB,oBAAzB;AAEA;AACA;AACA;;AACA,OAAOC,MAAP,MAAmB,eAAnB;AACA,SAASC,aAAT,QAA8B,2BAA9B;AAEA,MAAMC,KAAK,GAAGf,QAAQ,CAACgB,EAAT,KAAgB,KAA9B;;AAEA,SAASC,MAAT,OAMI;AAAA,MANa;AAChBC,IAAAA,wBADgB;AAEhBC,IAAAA,kBAFgB;AAGhBC,IAAAA,cAHgB;AAIhBC,IAAAA,UAJgB;AAKhBC,IAAAA;AALgB,GAMb;AACH,QAAM;AAAEC,IAAAA,EAAF;AAAMC,IAAAA;AAAN,MAAcH,UAApB;AACA,QAAM,CAAEI,MAAF,EAAUC,SAAV,IAAwBd,QAAQ,CAAE,IAAF,CAAtC;;AAEA,QAAMe,aAAa,GAAG,MAAM;AAC3B,QAAKH,GAAL,EAAW;AACV,UAAKT,KAAK,IAAI,KAAKa,MAAnB,EAA4B;AAC3B,aAAKA,MAAL,CAAYC,uBAAZ;AACA;AACA;;AAED/B,MAAAA,OAAO,CAACgC,UAAR,CAAoBN,GAApB,EACEO,IADF,CACUC,SAAF,IAAiB;AACvB,YAAK,CAAEA,SAAP,EAAmB;AAClBjC,UAAAA,KAAK,CAACkC,KAAN,CACC3B,EAAE,CAAE,2BAAF,CADH,EAECA,EAAE,CAAE,yCAAF,CAFH;AAIA,SALD,MAKO;AACN,iBAAOR,OAAO,CAACoC,OAAR,CAAiBV,GAAjB,CAAP;AACA;AACD,OAVF,EAWEW,KAXF,CAWS,MAAM;AACbpC,QAAAA,KAAK,CAACkC,KAAN,CACC3B,EAAE,CAAE,2BAAF,CADH,EAECA,EAAE,CAAE,8CAAF,CAFH;AAIA,OAhBF;AAiBA;AACD,GAzBD;;AA2BA,QAAM8B,cAAc,GAAGlB,wBAAwB,CAC9CL,MAAM,CAACwB,SADuC,EAE9CxB,MAAM,CAACyB,aAFuC,CAA/C;AAKA,QAAMC,SAAS,GAAGrB,wBAAwB,CAAEL,MAAM,CAAC2B,IAAT,EAAe3B,MAAM,CAAC4B,QAAtB,CAA1C;AAEA,QAAMC,iBAAiB,GAAGxB,wBAAwB,CACjDL,MAAM,CAAC8B,YAD0C,EAEjD9B,MAAM,CAAC+B,gBAF0C,CAAlD;AAKA,QAAMC,UAAU,GAAGzB,cAAc,IAAID,kBAArC;AAEA,QAAM2B,cAAc,GAAG,EACtB,GAAGP,SADmB;AAEtB,QAAKM,UAAU,IAAIH,iBAAnB;AAFsB,GAAvB;AAKA,QAAMK,kBAAkB,GAAG7B,wBAAwB,CAClDL,MAAM,CAACmC,aAD2C,EAElDnC,MAAM,CAACoC,iBAF2C,CAAnD;AAKA,QAAMC,mBAAmB,GAAG,EAC3B,GAAGrC,MAAM,CAACsC,cADiB;AAE3B,QAAKpC,KAAK,GAAGF,MAAM,CAACuC,iBAAV,GAA8BvC,MAAM,CAACwC,qBAA/C;AAF2B,GAA5B;AAKA,QAAMC,UAAU,GAAGpC,wBAAwB,CAC1CL,MAAM,CAAC0C,KADmC,EAE1C1C,MAAM,CAAC2C,SAFmC,CAA3C;AAKA,QAAMC,iBAAiB,GAAGvC,wBAAwB,CACjDL,MAAM,CAAC6C,YAD0C,EAEjD7C,MAAM,CAAC8C,gBAF0C,CAAlD;AAKA,QAAMC,aAAa,GAAG1C,wBAAwB,CAC7CL,MAAM,CAACgD,QADsC,EAE7ChD,MAAM,CAACiD,YAFsC,CAA9C;AAKA,QAAMC,kBAAkB,GAAG,EAC1B,GAAGH,aADuB;AAE1B,QAAKxC,cAAc,IAAIqC,iBAAvB;AAF0B,GAA3B;AAKA,QAAMO,qBAAqB,GAAG9C,wBAAwB,CACrDL,MAAM,CAACoD,gBAD8C,EAErDpD,MAAM,CAACqD,oBAF8C,CAAtD;AAKA,MAAIX,KAAK,GAAG,EAAZ;AACA,MAAIY,SAAS,GAAG,EAAhB;;AAEA,MAAK3C,GAAL,EAAW;AACV,UAAM4C,MAAM,GAAGtD,aAAa,CAAEU,GAAF,CAA5B;AACA2C,IAAAA,SAAS,GAAGC,MAAM,CAACD,SAAnB;AACAZ,IAAAA,KAAK,GAAGa,MAAM,CAACb,KAAf;AACA;;AAED,QAAMc,gBAAgB,GAAG,MAAM;AAC9B,QAAKlD,kBAAL,EAA0B;AACzB,aAAOb,EAAE,CAAE,YAAF,CAAT;AACA;;AACD,QAAKc,cAAL,EAAsB;AACrB,aAAOd,EAAE,CAAE,sDAAF,CAAT;AACA;;AACD,WACC6D,SAAS,GACT;AACA7D,IAAAA,EAAE,CAAE,YAAF,CAHH;AAKA,GAZD;;AAcA,WAASgE,yBAAT,GAAqC;AACpC,QAAKnD,kBAAL,EAA0B;AACzBT,MAAAA,8BAA8B,CAAEa,EAAF,CAA9B;AACA,KAFD,MAEO,IAAKA,EAAE,IAAIZ,WAAW,CAAEa,GAAF,CAAX,KAAuB,OAAlC,EAA4C;AAClDf,MAAAA,6BAA6B,CAAEc,EAAF,CAA7B;AACA;AACD;;AAED,SACC,cAAC,wBAAD;AACC,IAAA,UAAU,EAAG,CAAED,UADhB;AAEC,IAAA,QAAQ,EAAG,CAAEA,UAFd;AAGC,IAAA,OAAO,EAAGgD;AAHX,KAKC,cAAC,IAAD;AAAM,IAAA,KAAK,EAAGlC;AAAd,KACC,cAAC,IAAD;AAAM,IAAA,KAAK,EAAGW;AAAd,KACC,cAAC,IAAD;AAAM,IAAA,IAAI,EAAGxC,KAAb;AAAqB,IAAA,KAAK,EAAGuC,cAA7B;AAA8C,IAAA,IAAI,EAAG;AAArD,IADD,CADD,EAIC,cAAC,IAAD;AAAM,IAAA,KAAK,EAAGI;AAAd,KACC,cAAC,IAAD;AAAM,IAAA,KAAK,EAAGI;AAAd,KAA6BC,KAA7B,CADD,EAEC,cAAC,IAAD;AAAM,IAAA,KAAK,EAAG1C,MAAM,CAAC0D;AAArB,KACGnD,cAAc,IACf,cAAC,IAAD;AACC,IAAA,IAAI,EAAGZ,OADR;AAEC,IAAA,KAAK,EAAG,EACP,GAAGK,MAAM,CAAC2D,SADH;AAEP,SAAGf;AAFI,KAFT;AAMC,IAAA,IAAI,EAAG;AANR,IAFF,EAWC,cAAC,IAAD;AAAM,IAAA,KAAK,EAAGM;AAAd,KACGM,gBAAgB,EADnB,CAXD,CAFD,CAJD,EAsBG,CAAExB,UAAF,IACD,cAAC,wBAAD;AACC,IAAA,kBAAkB,EAAGvC,EAAE,CAAE,cAAF,CADxB;AAEC,IAAA,iBAAiB,EAAG,QAFrB;AAGC,IAAA,iBAAiB,EAAGA,EAAE,CACrB,qCADqB,CAHvB;AAMC,IAAA,OAAO,EAAGqB;AANX,KAQC,cAAC,IAAD;AAAM,IAAA,KAAK,EAAGqC;AAAd,KACC,cAAC,IAAD;AAAM,IAAA,KAAK,EAAGnD,MAAM,CAAC4D;AAArB,KACGnE,EAAE,CAAE,MAAF,CADL,CADD,CARD,CAvBF,EAsCGS,KAAK,IACN,cAAC,WAAD;AACC,IAAA,MAAM,EAAG;AAAE2D,MAAAA,GAAG,EAAElD;AAAP,KADV;AAEC,IAAA,MAAM,EAAGC,MAFV;AAGC,IAAA,GAAG,EAAKkD,GAAF,IAAW;AAChB,WAAK/C,MAAL,GAAc+C,GAAd;AACA,KALF;AAMC,IAAA,QAAQ,EAAG,KANZ;AAOC,IAAA,kBAAkB,EAAG,QAPtB;AAQC,IAAA,6BAA6B,EAAG,MAAM;AACrCjD,MAAAA,SAAS,CAAE,KAAF,CAAT;AACA,KAVF;AAWC,IAAA,4BAA4B,EAAG,MAAM;AACpCA,MAAAA,SAAS,CAAE,IAAF,CAAT;AACA;AAbF,IAvCF,CALD,CADD;AAgEA;;AAED,eAAerB,wBAAwB,CAAEY,MAAF,CAAvC","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tText,\n\tTouchableWithoutFeedback,\n\tLinking,\n\tAlert,\n\tPlatform,\n} from 'react-native';\nimport { default as VideoPlayer } from 'react-native-video';\n\n/**\n * WordPress dependencies\n */\nimport { View } from '@wordpress/primitives';\nimport { Icon } from '@wordpress/components';\nimport { withPreferredColorScheme } from '@wordpress/compose';\nimport { __ } from '@wordpress/i18n';\nimport { audio, warning } from '@wordpress/icons';\nimport {\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n} from '@wordpress/react-native-bridge';\nimport { getProtocol } from '@wordpress/url';\nimport { useState } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport styles from './styles.scss';\nimport { parseAudioUrl } from './audio-url-parser.native';\n\nconst isIOS = Platform.OS === 'ios';\n\nfunction Player( {\n\tgetStylesFromColorScheme,\n\tisUploadInProgress,\n\tisUploadFailed,\n\tattributes,\n\tisSelected,\n} ) {\n\tconst { id, src } = attributes;\n\tconst [ paused, setPaused ] = useState( true );\n\n\tconst onPressListen = () => {\n\t\tif ( src ) {\n\t\t\tif ( isIOS && this.player ) {\n\t\t\t\tthis.player.presentFullscreenPlayer();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tLinking.canOpenURL( src )\n\t\t\t\t.then( ( supported ) => {\n\t\t\t\t\tif ( ! supported ) {\n\t\t\t\t\t\tAlert.alert(\n\t\t\t\t\t\t\t__( 'Problem opening the audio' ),\n\t\t\t\t\t\t\t__( 'No application can handle this request.' )\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn Linking.openURL( src );\n\t\t\t\t\t}\n\t\t\t\t} )\n\t\t\t\t.catch( () => {\n\t\t\t\t\tAlert.alert(\n\t\t\t\t\t\t__( 'Problem opening the audio' ),\n\t\t\t\t\t\t__( 'An unknown error occurred. Please try again.' )\n\t\t\t\t\t);\n\t\t\t\t} );\n\t\t}\n\t};\n\n\tconst containerStyle = getStylesFromColorScheme(\n\t\tstyles.container,\n\t\tstyles.containerDark\n\t);\n\n\tconst iconStyle = getStylesFromColorScheme( styles.icon, styles.iconDark );\n\n\tconst iconDisabledStyle = getStylesFromColorScheme(\n\t\tstyles.iconDisabled,\n\t\tstyles.iconDisabledDark\n\t);\n\n\tconst isDisabled = isUploadFailed || isUploadInProgress;\n\n\tconst finalIconStyle = {\n\t\t...iconStyle,\n\t\t...( isDisabled && iconDisabledStyle ),\n\t};\n\n\tconst iconContainerStyle = getStylesFromColorScheme(\n\t\tstyles.iconContainer,\n\t\tstyles.iconContainerDark\n\t);\n\n\tconst titleContainerStyle = {\n\t\t...styles.titleContainer,\n\t\t...( isIOS ? styles.titleContainerIOS : styles.titleContainerAndroid ),\n\t};\n\n\tconst titleStyle = getStylesFromColorScheme(\n\t\tstyles.title,\n\t\tstyles.titleDark\n\t);\n\n\tconst uploadFailedStyle = getStylesFromColorScheme(\n\t\tstyles.uploadFailed,\n\t\tstyles.uploadFailedDark\n\t);\n\n\tconst subtitleStyle = getStylesFromColorScheme(\n\t\tstyles.subtitle,\n\t\tstyles.subtitleDark\n\t);\n\n\tconst finalSubtitleStyle = {\n\t\t...subtitleStyle,\n\t\t...( isUploadFailed && uploadFailedStyle ),\n\t};\n\n\tconst buttonBackgroundStyle = getStylesFromColorScheme(\n\t\tstyles.buttonBackground,\n\t\tstyles.buttonBackgroundDark\n\t);\n\n\tlet title = '';\n\tlet extension = '';\n\n\tif ( src ) {\n\t\tconst result = parseAudioUrl( src );\n\t\textension = result.extension;\n\t\ttitle = result.title;\n\t}\n\n\tconst getSubtitleValue = () => {\n\t\tif ( isUploadInProgress ) {\n\t\t\treturn __( 'Uploadingâ€¦' );\n\t\t}\n\t\tif ( isUploadFailed ) {\n\t\t\treturn __( 'Failed to insert audio file. Please tap for options.' );\n\t\t}\n\t\treturn (\n\t\t\textension +\n\t\t\t// translators: displays audio file extension. e.g. MP3 audio file\n\t\t\t__( 'audio file' )\n\t\t);\n\t};\n\n\tfunction onAudioUploadCancelDialog() {\n\t\tif ( isUploadInProgress ) {\n\t\t\trequestImageUploadCancelDialog( id );\n\t\t} else if ( id && getProtocol( src ) === 'file:' ) {\n\t\t\trequestImageFailedRetryDialog( id );\n\t\t}\n\t}\n\n\treturn (\n\t\t<TouchableWithoutFeedback\n\t\t\taccessible={ ! isSelected }\n\t\t\tdisabled={ ! isSelected }\n\t\t\tonPress={ onAudioUploadCancelDialog }\n\t\t>\n\t\t\t<View style={ containerStyle }>\n\t\t\t\t<View style={ iconContainerStyle }>\n\t\t\t\t\t<Icon icon={ audio } style={ finalIconStyle } size={ 24 } />\n\t\t\t\t</View>\n\t\t\t\t<View style={ titleContainerStyle }>\n\t\t\t\t\t<Text style={ titleStyle }>{ title }</Text>\n\t\t\t\t\t<View style={ styles.subtitleContainer }>\n\t\t\t\t\t\t{ isUploadFailed && (\n\t\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\t\ticon={ warning }\n\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\t...styles.errorIcon,\n\t\t\t\t\t\t\t\t\t...uploadFailedStyle,\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\tsize={ 16 }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t<Text style={ finalSubtitleStyle }>\n\t\t\t\t\t\t\t{ getSubtitleValue() }\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t</View>\n\t\t\t\t</View>\n\t\t\t\t{ ! isDisabled && (\n\t\t\t\t\t<TouchableWithoutFeedback\n\t\t\t\t\t\taccessibilityLabel={ __( 'Audio Player' ) }\n\t\t\t\t\t\taccessibilityRole={ 'button' }\n\t\t\t\t\t\taccessibilityHint={ __(\n\t\t\t\t\t\t\t'Double tap to listen the audio file'\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tonPress={ onPressListen }\n\t\t\t\t\t>\n\t\t\t\t\t\t<View style={ buttonBackgroundStyle }>\n\t\t\t\t\t\t\t<Text style={ styles.buttonText }>\n\t\t\t\t\t\t\t\t{ __( 'OPEN' ) }\n\t\t\t\t\t\t\t</Text>\n\t\t\t\t\t\t</View>\n\t\t\t\t\t</TouchableWithoutFeedback>\n\t\t\t\t) }\n\t\t\t\t{ isIOS && (\n\t\t\t\t\t<VideoPlayer\n\t\t\t\t\t\tsource={ { uri: src } }\n\t\t\t\t\t\tpaused={ paused }\n\t\t\t\t\t\tref={ ( ref ) => {\n\t\t\t\t\t\t\tthis.player = ref;\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tcontrols={ false }\n\t\t\t\t\t\tignoreSilentSwitch={ 'ignore' }\n\t\t\t\t\t\tonFullscreenPlayerWillPresent={ () => {\n\t\t\t\t\t\t\tsetPaused( false );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tonFullscreenPlayerDidDismiss={ () => {\n\t\t\t\t\t\t\tsetPaused( true );\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</View>\n\t\t</TouchableWithoutFeedback>\n\t);\n}\n\nexport default withPreferredColorScheme( Player );\n"]}