{"version":3,"sources":["@wordpress/components/src/popover/utils.ts"],"names":["POSITION_TO_PLACEMENT","bottom","top","middle","positionToPlacement","position","PLACEMENT_TO_ANIMATION_ORIGIN","originX","originY","right","left","overlay","placementToMotionAnimationProps","placement","translateProp","startsWith","translateDirection","style","initial","opacity","scale","animate","transition","duration","ease","getFrameOffset","document","frameElement","defaultView","iframeRect","getBoundingClientRect","x","y","getFrameScale","rect","width","offsetWidth","height","offsetHeight","getReferenceOwnerDocument","anchor","anchorRef","anchorRect","getAnchorRect","fallbackReferenceElement","fallbackDocument","resultingReferenceOwnerDoc","ownerDocument","startContainer","current","getReferenceElement","referenceElement","topRect","bottomRect","window","DOMRect","parentElement"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\n// eslint-disable-next-line no-restricted-imports\nimport type { MotionProps } from 'framer-motion';\nimport type { ReferenceType } from '@floating-ui/react-dom';\n\n/**\n * Internal dependencies\n */\nimport type {\n\tPopoverProps,\n\tPopoverAnchorRefReference,\n\tPopoverAnchorRefTopBottom,\n} from './types';\n\nconst POSITION_TO_PLACEMENT: Record<\n\tNonNullable< PopoverProps[ 'position' ] >,\n\tNonNullable< PopoverProps[ 'placement' ] >\n> = {\n\tbottom: 'bottom',\n\ttop: 'top',\n\t'middle left': 'left',\n\t'middle right': 'right',\n\t'bottom left': 'bottom-end',\n\t'bottom center': 'bottom',\n\t'bottom right': 'bottom-start',\n\t'top left': 'top-end',\n\t'top center': 'top',\n\t'top right': 'top-start',\n\t'middle left left': 'left',\n\t'middle left right': 'left',\n\t'middle left bottom': 'left-end',\n\t'middle left top': 'left-start',\n\t'middle right left': 'right',\n\t'middle right right': 'right',\n\t'middle right bottom': 'right-end',\n\t'middle right top': 'right-start',\n\t'bottom left left': 'bottom-end',\n\t'bottom left right': 'bottom-end',\n\t'bottom left bottom': 'bottom-end',\n\t'bottom left top': 'bottom-end',\n\t'bottom center left': 'bottom',\n\t'bottom center right': 'bottom',\n\t'bottom center bottom': 'bottom',\n\t'bottom center top': 'bottom',\n\t'bottom right left': 'bottom-start',\n\t'bottom right right': 'bottom-start',\n\t'bottom right bottom': 'bottom-start',\n\t'bottom right top': 'bottom-start',\n\t'top left left': 'top-end',\n\t'top left right': 'top-end',\n\t'top left bottom': 'top-end',\n\t'top left top': 'top-end',\n\t'top center left': 'top',\n\t'top center right': 'top',\n\t'top center bottom': 'top',\n\t'top center top': 'top',\n\t'top right left': 'top-start',\n\t'top right right': 'top-start',\n\t'top right bottom': 'top-start',\n\t'top right top': 'top-start',\n\t// `middle`/`middle center [corner?]` positions are associated to a fallback\n\t// `bottom` placement because there aren't any corresponding placement values.\n\tmiddle: 'bottom',\n\t'middle center': 'bottom',\n\t'middle center bottom': 'bottom',\n\t'middle center left': 'bottom',\n\t'middle center right': 'bottom',\n\t'middle center top': 'bottom',\n};\n\n/**\n * Converts the `Popover`'s legacy \"position\" prop to the new \"placement\" prop\n * (used by `floating-ui`).\n *\n * @param position The legacy position\n * @return The corresponding placement\n */\nexport const positionToPlacement = (\n\tposition: NonNullable< PopoverProps[ 'position' ] >\n): NonNullable< PopoverProps[ 'placement' ] > =>\n\tPOSITION_TO_PLACEMENT[ position ] ?? 'bottom';\n\n/**\n * @typedef AnimationOrigin\n * @type {Object}\n * @property {number} originX A number between 0 and 1 (in CSS logical properties jargon, 0 is \"start\", 0.5 is \"center\", and 1 is \"end\")\n * @property {number} originY A number between 0 and 1 (0 is top, 0.5 is center, and 1 is bottom)\n */\n\nconst PLACEMENT_TO_ANIMATION_ORIGIN: Record<\n\tNonNullable< PopoverProps[ 'placement' ] >,\n\t{ originX: number; originY: number }\n> = {\n\ttop: { originX: 0.5, originY: 1 }, // open from bottom, center\n\t'top-start': { originX: 0, originY: 1 }, // open from bottom, left\n\t'top-end': { originX: 1, originY: 1 }, // open from bottom, right\n\tright: { originX: 0, originY: 0.5 }, // open from middle, left\n\t'right-start': { originX: 0, originY: 0 }, // open from top, left\n\t'right-end': { originX: 0, originY: 1 }, // open from bottom, left\n\tbottom: { originX: 0.5, originY: 0 }, // open from top, center\n\t'bottom-start': { originX: 0, originY: 0 }, // open from top, left\n\t'bottom-end': { originX: 1, originY: 0 }, // open from top, right\n\tleft: { originX: 1, originY: 0.5 }, // open from middle, right\n\t'left-start': { originX: 1, originY: 0 }, // open from top, right\n\t'left-end': { originX: 1, originY: 1 }, // open from bottom, right\n\toverlay: { originX: 0.5, originY: 0.5 }, // open from center, center\n};\n\n/**\n * Given the floating-ui `placement`, compute the framer-motion props for the\n * popover's entry animation.\n *\n * @param placement A placement string from floating ui\n * @return The object containing the motion props\n */\nexport const placementToMotionAnimationProps = (\n\tplacement: NonNullable< PopoverProps[ 'placement' ] >\n): MotionProps => {\n\tconst translateProp =\n\t\tplacement.startsWith( 'top' ) || placement.startsWith( 'bottom' )\n\t\t\t? 'translateY'\n\t\t\t: 'translateX';\n\tconst translateDirection =\n\t\tplacement.startsWith( 'top' ) || placement.startsWith( 'left' )\n\t\t\t? 1\n\t\t\t: -1;\n\n\treturn {\n\t\tstyle: PLACEMENT_TO_ANIMATION_ORIGIN[ placement ],\n\t\tinitial: {\n\t\t\topacity: 0,\n\t\t\tscale: 0,\n\t\t\t[ translateProp ]: `${ 2 * translateDirection }em`,\n\t\t},\n\t\tanimate: { opacity: 1, scale: 1, [ translateProp ]: 0 },\n\t\ttransition: { duration: 0.1, ease: [ 0, 0, 0.2, 1 ] },\n\t};\n};\n\n/**\n * Returns the offset of a document's frame element.\n *\n * @param document The iframe's owner document.\n *\n * @return The offset of the document's frame element, or undefined if the\n * document has no frame element.\n */\nexport const getFrameOffset = (\n\tdocument?: Document\n): { x: number; y: number } | undefined => {\n\tconst frameElement = document?.defaultView?.frameElement;\n\tif ( ! frameElement ) {\n\t\treturn;\n\t}\n\tconst iframeRect = frameElement.getBoundingClientRect();\n\treturn { x: iframeRect.left, y: iframeRect.top };\n};\n\nexport const getFrameScale = (\n\tdocument?: Document\n): {\n\tx: number;\n\ty: number;\n} => {\n\tconst frameElement = document?.defaultView?.frameElement as HTMLElement;\n\tif ( ! frameElement ) {\n\t\treturn { x: 1, y: 1 };\n\t}\n\tconst rect = frameElement.getBoundingClientRect();\n\treturn {\n\t\tx: rect.width / frameElement.offsetWidth,\n\t\ty: rect.height / frameElement.offsetHeight,\n\t};\n};\n\nexport const getReferenceOwnerDocument = ( {\n\tanchor,\n\tanchorRef,\n\tanchorRect,\n\tgetAnchorRect,\n\tfallbackReferenceElement,\n\tfallbackDocument,\n}: Pick<\n\tPopoverProps,\n\t'anchorRef' | 'anchorRect' | 'getAnchorRect' | 'anchor'\n> & {\n\tfallbackReferenceElement: Element | null;\n\tfallbackDocument: Document;\n} ): Document => {\n\t// In floating-ui's terms:\n\t// - \"reference\" refers to the popover's anchor element.\n\t// - \"floating\" refers the floating popover's element.\n\t// A floating element can also be positioned relative to a virtual element,\n\t// instead of a real one. A virtual element is represented by an object\n\t// with the `getBoundingClientRect()` function (like real elements).\n\t// See https://floating-ui.com/docs/virtual-elements for more info.\n\tlet resultingReferenceOwnerDoc;\n\tif ( anchor ) {\n\t\tresultingReferenceOwnerDoc = anchor.ownerDocument;\n\t} else if ( ( anchorRef as PopoverAnchorRefTopBottom | undefined )?.top ) {\n\t\tresultingReferenceOwnerDoc = ( anchorRef as PopoverAnchorRefTopBottom )\n\t\t\t?.top.ownerDocument;\n\t} else if ( ( anchorRef as Range | undefined )?.startContainer ) {\n\t\tresultingReferenceOwnerDoc = ( anchorRef as Range ).startContainer\n\t\t\t.ownerDocument;\n\t} else if (\n\t\t( anchorRef as PopoverAnchorRefReference | undefined )?.current\n\t) {\n\t\tresultingReferenceOwnerDoc = (\n\t\t\t( anchorRef as PopoverAnchorRefReference ).current as Element\n\t\t ).ownerDocument;\n\t} else if ( anchorRef as Element | undefined ) {\n\t\t// This one should be deprecated.\n\t\tresultingReferenceOwnerDoc = ( anchorRef as Element ).ownerDocument;\n\t} else if ( anchorRect && anchorRect?.ownerDocument ) {\n\t\tresultingReferenceOwnerDoc = anchorRect.ownerDocument;\n\t} else if ( getAnchorRect ) {\n\t\tresultingReferenceOwnerDoc = getAnchorRect(\n\t\t\tfallbackReferenceElement\n\t\t)?.ownerDocument;\n\t}\n\n\treturn resultingReferenceOwnerDoc ?? fallbackDocument;\n};\n\nexport const getReferenceElement = ( {\n\tanchor,\n\tanchorRef,\n\tanchorRect,\n\tgetAnchorRect,\n\tfallbackReferenceElement,\n\tscale,\n}: Pick<\n\tPopoverProps,\n\t'anchorRef' | 'anchorRect' | 'getAnchorRect' | 'anchor'\n> & {\n\tfallbackReferenceElement: Element | null;\n\tscale: { x: number; y: number };\n} ): ReferenceType | null => {\n\tlet referenceElement = null;\n\n\tif ( anchor ) {\n\t\treferenceElement = anchor;\n\t} else if ( ( anchorRef as PopoverAnchorRefTopBottom | undefined )?.top ) {\n\t\t// Create a virtual element for the ref. The expectation is that\n\t\t// if anchorRef.top is defined, then anchorRef.bottom is defined too.\n\t\t// Seems to be used by the block toolbar, when multiple blocks are selected\n\t\t// (top and bottom blocks are used to calculate the resulting rect).\n\t\treferenceElement = {\n\t\t\tgetBoundingClientRect() {\n\t\t\t\tconst topRect = (\n\t\t\t\t\tanchorRef as PopoverAnchorRefTopBottom\n\t\t\t\t ).top.getBoundingClientRect();\n\t\t\t\tconst bottomRect = (\n\t\t\t\t\tanchorRef as PopoverAnchorRefTopBottom\n\t\t\t\t ).bottom.getBoundingClientRect();\n\t\t\t\treturn new window.DOMRect(\n\t\t\t\t\ttopRect.x,\n\t\t\t\t\ttopRect.y,\n\t\t\t\t\ttopRect.width,\n\t\t\t\t\tbottomRect.bottom - topRect.top\n\t\t\t\t);\n\t\t\t},\n\t\t};\n\t} else if (\n\t\t( anchorRef as PopoverAnchorRefReference | undefined )?.current\n\t) {\n\t\t// Standard React ref.\n\t\treferenceElement = ( anchorRef as PopoverAnchorRefReference ).current;\n\t} else if ( anchorRef as Element | undefined ) {\n\t\t// If `anchorRef` holds directly the element's value (no `current` key)\n\t\t// This is a weird scenario and should be deprecated.\n\t\treferenceElement = anchorRef as Element;\n\t} else if ( anchorRect ) {\n\t\t// Create a virtual element for the ref.\n\t\treferenceElement = {\n\t\t\tgetBoundingClientRect() {\n\t\t\t\treturn anchorRect;\n\t\t\t},\n\t\t};\n\t} else if ( getAnchorRect ) {\n\t\t// Create a virtual element for the ref.\n\t\treferenceElement = {\n\t\t\tgetBoundingClientRect() {\n\t\t\t\tconst rect = getAnchorRect( fallbackReferenceElement );\n\t\t\t\treturn new window.DOMRect(\n\t\t\t\t\trect.x ?? rect.left,\n\t\t\t\t\trect.y ?? rect.top,\n\t\t\t\t\trect.width ?? rect.right - rect.left,\n\t\t\t\t\trect.height ?? rect.bottom - rect.top\n\t\t\t\t);\n\t\t\t},\n\t\t};\n\t} else if ( fallbackReferenceElement ) {\n\t\t// If no explicit ref is passed via props, fall back to\n\t\t// anchoring to the popover's parent node.\n\t\treferenceElement = fallbackReferenceElement.parentElement;\n\t}\n\n\tif ( referenceElement && ( scale.x !== 1 || scale.y !== 1 ) ) {\n\t\t// If the popover is inside an iframe, the coordinates of the\n\t\t// reference element need to be scaled to match the iframe's scale.\n\t\tconst rect = referenceElement.getBoundingClientRect();\n\t\treferenceElement = {\n\t\t\tgetBoundingClientRect() {\n\t\t\t\treturn new window.DOMRect(\n\t\t\t\t\trect.x * scale.x,\n\t\t\t\t\trect.y * scale.y,\n\t\t\t\t\trect.width * scale.x,\n\t\t\t\t\trect.height * scale.y\n\t\t\t\t);\n\t\t\t},\n\t\t};\n\t}\n\n\t// Convert any `undefined` value to `null`.\n\treturn referenceElement ?? null;\n};\n"]}