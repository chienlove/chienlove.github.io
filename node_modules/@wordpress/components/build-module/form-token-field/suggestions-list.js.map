{"version":3,"sources":["@wordpress/components/src/form-token-field/suggestions-list.tsx"],"names":["scrollView","classnames","useState","useRefEffect","handleMouseDown","e","preventDefault","SuggestionsList","selectedIndex","scrollIntoView","match","onHover","onSelect","suggestions","displayTransform","instanceId","__experimentalRenderItem","scrollingIntoView","setScrollingIntoView","listRef","listNode","rafId","children","onlyScrollIfNeeded","requestAnimationFrame","undefined","cancelAnimationFrame","handleHover","suggestion","handleClick","computeSuggestionMatch","matchText","toLocaleLowerCase","length","transformedSuggestion","indexOfMatch","indexOf","suggestionBeforeMatch","substring","suggestionMatch","suggestionAfterMatch","map","index","className","output","item","value"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport scrollView from 'dom-scroll-into-view';\nimport classnames from 'classnames';\nimport type { MouseEventHandler, ReactNode } from 'react';\n\n/**\n * WordPress dependencies\n */\nimport { useState } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport type { SuggestionsListProps } from './types';\n\nconst handleMouseDown: MouseEventHandler = ( e ) => {\n\t// By preventing default here, we will not lose focus of <input> when clicking a suggestion.\n\te.preventDefault();\n};\n\nexport function SuggestionsList< T extends string | { value: string } >( {\n\tselectedIndex,\n\tscrollIntoView,\n\tmatch,\n\tonHover,\n\tonSelect,\n\tsuggestions = [],\n\tdisplayTransform,\n\tinstanceId,\n\t__experimentalRenderItem,\n}: SuggestionsListProps< T > ) {\n\tconst [ scrollingIntoView, setScrollingIntoView ] = useState( false );\n\n\tconst listRef = useRefEffect< HTMLUListElement >(\n\t\t( listNode ) => {\n\t\t\t// only have to worry about scrolling selected suggestion into view\n\t\t\t// when already expanded.\n\t\t\tlet rafId: number | undefined;\n\t\t\tif (\n\t\t\t\tselectedIndex > -1 &&\n\t\t\t\tscrollIntoView &&\n\t\t\t\tlistNode.children[ selectedIndex ]\n\t\t\t) {\n\t\t\t\tsetScrollingIntoView( true );\n\t\t\t\tscrollView(\n\t\t\t\t\tlistNode.children[ selectedIndex ] as HTMLLIElement,\n\t\t\t\t\tlistNode,\n\t\t\t\t\t{\n\t\t\t\t\t\tonlyScrollIfNeeded: true,\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\trafId = requestAnimationFrame( () => {\n\t\t\t\t\tsetScrollingIntoView( false );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\treturn () => {\n\t\t\t\tif ( rafId !== undefined ) {\n\t\t\t\t\tcancelAnimationFrame( rafId );\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\t[ selectedIndex, scrollIntoView ]\n\t);\n\n\tconst handleHover = ( suggestion: T ) => {\n\t\treturn () => {\n\t\t\tif ( ! scrollingIntoView ) {\n\t\t\t\tonHover?.( suggestion );\n\t\t\t}\n\t\t};\n\t};\n\n\tconst handleClick = ( suggestion: T ) => {\n\t\treturn () => {\n\t\t\tonSelect?.( suggestion );\n\t\t};\n\t};\n\n\tconst computeSuggestionMatch = ( suggestion: T ) => {\n\t\tconst matchText = displayTransform( match ).toLocaleLowerCase();\n\t\tif ( matchText.length === 0 ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst transformedSuggestion = displayTransform( suggestion );\n\t\tconst indexOfMatch = transformedSuggestion\n\t\t\t.toLocaleLowerCase()\n\t\t\t.indexOf( matchText );\n\n\t\treturn {\n\t\t\tsuggestionBeforeMatch: transformedSuggestion.substring(\n\t\t\t\t0,\n\t\t\t\tindexOfMatch\n\t\t\t),\n\t\t\tsuggestionMatch: transformedSuggestion.substring(\n\t\t\t\tindexOfMatch,\n\t\t\t\tindexOfMatch + matchText.length\n\t\t\t),\n\t\t\tsuggestionAfterMatch: transformedSuggestion.substring(\n\t\t\t\tindexOfMatch + matchText.length\n\t\t\t),\n\t\t};\n\t};\n\n\treturn (\n\t\t<ul\n\t\t\tref={ listRef }\n\t\t\tclassName=\"components-form-token-field__suggestions-list\"\n\t\t\tid={ `components-form-token-suggestions-${ instanceId }` }\n\t\t\trole=\"listbox\"\n\t\t>\n\t\t\t{ suggestions.map( ( suggestion, index ) => {\n\t\t\t\tconst matchText = computeSuggestionMatch( suggestion );\n\t\t\t\tconst className = classnames(\n\t\t\t\t\t'components-form-token-field__suggestion',\n\t\t\t\t\t{\n\t\t\t\t\t\t'is-selected': index === selectedIndex,\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tlet output: ReactNode;\n\n\t\t\t\tif ( typeof __experimentalRenderItem === 'function' ) {\n\t\t\t\t\toutput = __experimentalRenderItem( { item: suggestion } );\n\t\t\t\t} else if ( matchText ) {\n\t\t\t\t\toutput = (\n\t\t\t\t\t\t<span aria-label={ displayTransform( suggestion ) }>\n\t\t\t\t\t\t\t{ matchText.suggestionBeforeMatch }\n\t\t\t\t\t\t\t<strong className=\"components-form-token-field__suggestion-match\">\n\t\t\t\t\t\t\t\t{ matchText.suggestionMatch }\n\t\t\t\t\t\t\t</strong>\n\t\t\t\t\t\t\t{ matchText.suggestionAfterMatch }\n\t\t\t\t\t\t</span>\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\toutput = displayTransform( suggestion );\n\t\t\t\t}\n\n\t\t\t\t/* eslint-disable jsx-a11y/click-events-have-key-events */\n\t\t\t\treturn (\n\t\t\t\t\t<li\n\t\t\t\t\t\tid={ `components-form-token-suggestions-${ instanceId }-${ index }` }\n\t\t\t\t\t\trole=\"option\"\n\t\t\t\t\t\tclassName={ className }\n\t\t\t\t\t\tkey={\n\t\t\t\t\t\t\ttypeof suggestion === 'object' &&\n\t\t\t\t\t\t\t'value' in suggestion\n\t\t\t\t\t\t\t\t? suggestion?.value\n\t\t\t\t\t\t\t\t: displayTransform( suggestion )\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonMouseDown={ handleMouseDown }\n\t\t\t\t\t\tonClick={ handleClick( suggestion ) }\n\t\t\t\t\t\tonMouseEnter={ handleHover( suggestion ) }\n\t\t\t\t\t\taria-selected={ index === selectedIndex }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ output }\n\t\t\t\t\t</li>\n\t\t\t\t);\n\t\t\t\t/* eslint-enable jsx-a11y/click-events-have-key-events */\n\t\t\t} ) }\n\t\t</ul>\n\t);\n}\n\nexport default SuggestionsList;\n"]}