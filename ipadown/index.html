<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IPA Downloader</title>
  <meta name="description" content="TTJB IPA Downloader" />
  <meta name="keywords" content="TTJB IPA Downloader" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta property="og:title" content="TTJB IPA Downloader" />
  <meta property="og:site_name" content="TTJB IPA Downloader" />
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- reCAPTCHA script -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3905625903416797" crossorigin="anonymous"></script>
  <style>
  body, .navbar-brand, .nav-link, .form-label, .form-control, .btn, .text-white {
          font-family: 'Nunito', sans-serif;
      }
      footer.footer {
      margin-top: 20px;
      }
      
  #download-btn {
      background-color: red; 
      color: white; 
      width: 70%; 
      padding: 10px; 
      text-align: center;
      display: block;
      text-decoration: none;
      border: none;
      border-radius: 5px;
      margin-bottom: 10px;
  }
  
  #download-url-btn {
      background-color: green;
      color: white;
      width: 60%;
      padding: 10px; 
      text-align: center;
      display: block;
      text-decoration: none;
      border: none; 
      border-radius: 5px; 
      margin-bottom: 10px; 
  }
  
  #install-ipa-btn {
      background-color: blue;
      color: white;
      width: 60%;
      padding: 10px;
      text-align: center;
      display: block;
      text-decoration: none;
      border: none;
      border-radius: 5px;
      margin-bottom: 10px;
  }

  #retry-btn {
      background-color: gray;
      color: white;
      width: 80%;
      padding: 10px;
      border: none;
      border-radius: 5px;
  }
  
  .button-container {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 10px;
      margin-top: 20px;
  }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #000000;">
    <div class="container">
      <a class="navbar-brand" href="https://storeios.net/ipadown">IPA Downloader</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" data-toggle="collapse" data-target="#navbarNav">
        <span class="navbar-toggler-icon">
        </span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="https://sign.thuthuatjb.com">TTJB IPA Signer</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://ipa.thuthuatjb.com">TTJB IPA Repo</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://cer.thuthuatjb.com">TTJB Cer</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://install.thuthuatjb.com">TTJB Box</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://ttstore.thuthuatjb.com">TTStore</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container mt-5">
    <p class="text-center mb-4">IPA Downloader là công cụ giúp bạn tải về hoặc cài đặt IPA phiên bản cũ bằng tài khoản của chính bạn. Ngoài ra nó còn có thể tải được cả những ứng dụng đã bị xoá khỏi Appstore (Yêu cầu AppleID của bạn đã tải về ứng dụng trước đó).</p>
    <form id="download-form" class="needs-validation" novalidate>
      <div class="form-group">
        <label for="APPID">APPID hoặc URL Appstore của Ứng dụng:</label>
        <input type="text" class="form-control" id="APPID" name="APPID" placeholder="VD: 1480068668 hoặc https://apps.apple.com/vn/app/messenger/id1480068668" required>
        <div class="invalid-feedback">Vui lòng điền APPID hoặc URL Appstore của Ứng dụng.</div>
      </div>
      <div class="form-group">
        <label for="appVerId">Số ID phiên bản (để trống sẽ tải bản mới nhất):</label>
        <div class="input-group">
          <input type="text" class="form-control" id="appVerId" name="appVerId" placeholder="VD: 812345678">
          <div class="input-group-append">
            <a href="https://ipa.thuthuatjb.com/historyver" class="btn btn-outline-secondary" target="_blank">Lấy ID phiên bản</a>
          </div>
        </div>
      </div>
      <div class="form-group">
        <label for="APPLE_ID">Apple ID:</label>
        <input type="email" class="form-control" id="APPLE_ID" name="APPLE_ID" placeholder="VD: appleid@icloud.com" required>
        <div class="invalid-feedback">Vui lòng nhập đúng Apple ID của bạn.</div>
      </div>
      <div class="form-group">
        <label for="PASSWORD">Mật khẩu:</label>
        <input type="password" class="form-control" id="PASSWORD" name="PASSWORD" required>
        <div class="invalid-feedback">Vui lòng nhập mật khẩu của bạn.</div>
      </div>
      <div class="form-group">
        <label for="VERIFICATION_CODE">Mã xác minh 2 bước (Trường hợp Apple ID của bạn bật 2FA, sau khi bấm Tải về IPA sẽ có mã gửi về thiết bị, lúc này hãy nhập Mã xác minh vào đây):</label>
        <input type="text" class="form-control" id="VERIFICATION_CODE" name="VERIFICATION_CODE">
      </div>
      <!-- reCAPTCHA widget -->
      <div class="form-group">
        <div class="g-recaptcha" data-sitekey="6Lf2qvApAAAAAGjsun0pjzoz_d8_JkuKnfVQDW_7">
        </div>
        <div class="invalid-feedback">Vui lòng xác minh bạn không phải là Robot.</div>
      </div>
      <p class="text-center mb-4">Lưu ý: Chungs tôi không bao giờ lưu trữ AppleID của bạn. Tất cả thông tin đều gửi thẳng đến Apple để xử lý. Bạn cũng có thể dùng AppleID phụ nếu không tin tưởng chúng tôi. AppleID có thể bị khoá nếu bạn nhập sai mật khẩu nhiều lần, đó là cơ chế an toàn của Apple không phải lỗi do chúng tôi.</p>
      <div id="alert-placeholder">
      </div>
      </div>
      <form id="download-form" class="needs-validation" novalidate>
        <!--input form -->
        <div class="button-container">
          <button id="download-btn" type="submit">Gửi yêu cầu tải xuống</button>
          <a id="download-url-btn" class="btn btn-primary d-none" target="_blank">Tải xuống IPA</a>
          <a id="install-ipa-btn" class="btn btn-primary d-none" target="_blank">Cài đặt IPA</a>
          <button id="retry-btn" class="btn btn-secondary d-none" type="button">Tạo yêu cầu tải xuống ứng dụng khác</button>
        </div>
      </form>
    </form>
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3905625903416797" crossorigin="anonymous"></script>
  </div>
  <!-- Footer -->
  <footer class="text-center text-white mt-5" style="background-color: #161616;">
    <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">© 2024 TTJB Team -
      <a class="text-white" href="https://t.me/thuthuatjb_sp">Nhóm hỗ trợ Telegram</a>|
      <a class="text-white" href="https://fb.com/thuthuatjb/">Fanpage Facebook</a>
    </div>
  </footer>
  <!-- Bootstrap JS and dependencies -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Script to handle form submission -->
  <script>
  (function () {
        'use strict';
        window.addEventListener('load', function () {
            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            var forms = document.getElementsByClassName('needs-validation');
            // Loop over them and prevent submission
            var validation = Array.prototype.filter.call(forms, function (form) {
                form.addEventListener('submit', function (event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    } else {
                        event.preventDefault();
                        var response = grecaptcha.getResponse();
                        if (response.length === 0) {
                            showAlert('danger', 'Vui lòng xác minh bạn không phải Robot.');
                        } else {
                            processAndSubmitForm(response);
                        }
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();
    
  function processAndSubmitForm(recaptchaResponse) {
      const appIdInput = $('#APPID').val();
      let appId = appIdInput;
  
      // Check if the APPID is a URL and extract the numeric ID
      const urlPattern = /https:\/\/apps\.apple\.com\/[^\/]+\/app\/(?:[^\/]+\/)?id(\d+)(?:\?.*)?/;
      const match = appIdInput.match(urlPattern);
      if (match) {
          appId = match[1];
      } else {
          // If the input is not a URL, consider it as the ID itself
          appId = appIdInput;
      }
  
      // Update the APPID input value with the extracted numeric ID
      $('#APPID').val(appId);
  
      const password = $('#PASSWORD').val();
      const verificationCode = $('#VERIFICATION_CODE').val();
  
      // Append the verification code to the password if provided
      const fullPassword = verificationCode ? password + verificationCode : password;
  
      // Update the password input value with the combined password
      $('#PASSWORD').val(fullPassword);
  
      const form = $('#download-form');
      const formData = form.serialize() + '&g-recaptcha-response=' + recaptchaResponse;
  
      // Hide Download button and show processing message
      $('#download-btn').addClass('d-none');
      showAlert('info', 'Đang xử lý yêu cầu của bạn, các ứng dụng có dung lượng lớn sẽ xử lý rất lâu, vui lòng chờ và không rời khỏi trang...');
  
      $.ajax({
          url: '/download',
          type: 'POST',
          data: formData,
          success: function(response) {
              const fileUrl = response.url;
              const redirectUrl = 'https://dl.thuthuatjb.com/ipa/download.html?url=' + encodeURIComponent(fileUrl);
			   //s0n1c's api for install ipa
              const installUrl = 'https://dl.thuthuatjb.com/ipa/install.html?url=' + encodeURIComponent(fileUrl);
  
              showAlert('success', 'IPA được lấy thành công. Bấm vào nút Tải xuống IPA để tải xuống IPA của bạn hoặc bấm Cài IPA để cài IPA vào thiết bị. Các liên kết tải về và cài đặt chỉ tồn tại trong 30 phút. Vui lòng không tải các trò chơi phiên bản cũ nhiều lần nếu không bạn sẽ bị chặn sử dụng.');
              
              // Ensure both buttons are created and displayed
              $('#download-url-btn').attr('href', redirectUrl).removeClass('d-none');
              $('#install-ipa-btn').attr('href', installUrl).removeClass('d-none');
              $('#retry-btn').removeClass('d-none');
          },
          error: function(xhr, status, error) {
              var message = 'Đã có lỗi xảy ra:<br>' +
                  '1. Kiểm tra các thông tin của bạn như AppID (hãy nhập số ID thay vì url), AppleID và mật khẩu.<br>' +
                  '2. Nếu bạn nhận được mã xác minh hãy nhập mã vào ô Mã xác minh 2 bước.<br>' +
                  '3. Công cụ này không thể lấy được ipa ứng dụng nếu AppleID của bạn đã nhập bên trên chưa từng tải ứng dụng đó bao giờ.';
              showAlert('danger', message);
              // Show Download button again immediately and start countdown
              $('#download-btn').removeClass('d-none').html('Kiểm tra và thử lại sau <span id="countdown">10</span> giây');
              countdown(10);
          }
      });
  }
  
  
    
    function countdown(seconds) {
        $('#download-btn').prop('disabled', true);
        var interval = setInterval(function() {
            seconds--;
            if (seconds <= 0) {
                clearInterval(interval);
                $('#download-btn').prop('disabled', false).html('Gửi yêu cầu tải xuống');
            } else {
                $('#countdown').text(seconds);
            }
        }, 1000);
    }
    
    function showAlert(type, message) {
        const alertPlaceholder = $('#alert-placeholder');
        const alertHtml = `<div class="alert alert-${type} alert-dismissible fade show" role="alert">
                               ${message}
                           </div>`;
        alertPlaceholder.html(alertHtml);
    }
    
    // Reload the page when the retry button is clicked
    $('#retry-btn').click(function() {
        location.reload();
    });
  </script>
</body>

</html>